<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard | Kalkulations-Trainer</title>
    <meta name="theme-color" content="#0a0a1a">
    <link rel="icon" href="./icons/icon.svg" type="image/svg+xml">
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<!-- Animated Background -->
<div class="bg-particles"></div>

<div class="container">

    <!-- Header -->
    <div class="header">
        <div class="header-icon">
            <svg class="icon icon-2xl" style="color: var(--accent);" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
        </div>
        <h1 id="welcomeTitle">Willkommen!</h1>
        <p>Bereit zum Üben?</p>
    </div>

    <!-- Stats Card -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Dein Fortschritt</span>
            <span class="badge" id="streakBadge">
                <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg>
                <span id="streakCount">0</span> Serie
            </span>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="statSolved">0</div>
                <div class="stat-label">Gelöst</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statAccuracy">0%</div>
                <div class="stat-label">Genauigkeit</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statBest">0</div>
                <div class="stat-label">Beste Serie</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <p class="text-center text-muted mt-1" id="progressText">0 von 11 Aufgaben gemeistert</p>
    </div>

    <!-- Course Card (NEW) -->
    <div class="card" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(99, 102, 241, 0.1)); border: 2px solid #8b5cf6;">
        <div class="card-header">
            <span class="card-title" style="color: #a78bfa;">Geführter Kurs</span>
            <span class="badge" style="background: #8b5cf6; color: white;">NEU</span>
        </div>
        <p class="text-muted mb-2" style="font-size: 0.9rem;">
            Lerne Schritt für Schritt alle Grundlagen und Aufgaben.
        </p>
        <a href="./kurs.html" class="btn btn-block" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; text-decoration: none;">
            <svg class="icon" viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"></path></svg>
            Kurs starten
        </a>
    </div>

    <!-- Quick Start -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Schnellstart</span>
        </div>
        
        <a href="./trainer.html" class="btn btn-primary btn-block btn-lg mb-2" style="text-decoration: none;">
            <svg class="icon" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
            Übung starten
        </a>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <a href="./trainer.html?random=1" class="btn btn-secondary" style="text-decoration: none;">
                <svg class="icon icon-sm" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="7" x2="7.01" y2="7"></line><line x1="17" y1="7" x2="17.01" y2="7"></line><line x1="7" y1="17" x2="7.01" y2="17"></line><line x1="17" y1="17" x2="17.01" y2="17"></line><line x1="12" y1="12" x2="12.01" y2="12"></line></svg>
                Zufällig
            </a>
            <a href="./trainer.html?mode=random" class="btn btn-secondary" style="text-decoration: none;">
                <svg class="icon icon-sm" viewBox="0 0 24 24"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
                Neue Zahlen
            </a>
        </div>
    </div>

    <!-- Task Overview -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Aufgaben-Übersicht</span>
        </div>
        
        <div class="task-grid" id="taskGrid">
            <!-- Wird per JS gefüllt -->
        </div>
        
        <p class="text-center text-muted mt-2" style="font-size: 0.8rem;">
            Tippe auf eine Aufgabe, um direkt zu starten
        </p>
    </div>

    <!-- Reference Card -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">
                <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                Betriebsdaten
            </span>
        </div>
        
        <div style="display: grid; gap: 8px; font-size: 0.85rem;">
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--glass-border);">
                <span class="text-muted">MGK Hörgeräte</span>
                <span class="text-accent">32,8 %</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--glass-border);">
                <span class="text-muted">MGK Otoplastik/Material</span>
                <span class="text-accent">35,4 %</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--glass-border);">
                <span class="text-muted">MGK Handelswaren</span>
                <span class="text-warning">108 %</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--glass-border);">
                <span class="text-muted">Fert. HG-Anpassung</span>
                <span class="text-accent">60,50 €/h</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--glass-border);">
                <span class="text-muted">Fert. Audiometrie</span>
                <span class="text-accent">63,40 €/h</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                <span class="text-muted">Fert. Werkstatt/Labor</span>
                <span class="text-accent">58,90 €/h</span>
            </div>
        </div>
    </div>

    <!-- Formulas Card -->
    <div class="card" style="background: linear-gradient(135deg, rgba(30, 30, 50, 0.9), rgba(20, 20, 40, 0.9));">
        <div class="card-header">
            <span class="card-title">
                <svg class="icon icon-sm" viewBox="0 0 24 24"><line x1="19" y1="5" x2="5" y2="19"></line><circle cx="6.5" cy="6.5" r="2.5"></circle><circle cx="17.5" cy="17.5" r="2.5"></circle></svg>
                Formeln
            </span>
        </div>
        
        <div style="font-family: monospace; font-size: 0.85rem; color: var(--accent); line-height: 2;">
            MEK = Listenpreis + Porto<br>
            MGK = MEK × Zuschlag%<br>
            Mges = MEK + MGK<br>
            Fert = (Min ÷ 60) × €/h<br>
            Sk = Mges + Fertigung<br>
            NVP = Sk + Gewinn<br>
            BVP = NVP × 1,19
        </div>
    </div>

</div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <a href="./home.html" class="nav-item active">
        <svg class="icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        <span>Home</span>
    </a>
    <a href="./trainer.html" class="nav-item">
        <svg class="icon" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="8" y2="10"></line><line x1="12" y1="10" x2="12" y2="10"></line><line x1="16" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="8" y2="14"></line></svg>
        <span>Üben</span>
    </a>
    <a href="./kurs.html" class="nav-item">
        <svg class="icon" viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c0 2 2 3 6 3s6-1 6-3v-5"></path></svg>
        <span>Kurs</span>
    </a>
    <a href="./profil.html" class="nav-item">
        <svg class="icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        <span>Profil</span>
    </a>
</nav>

<!-- Scripts -->
<script src="./js/storage.js?v=6"></script>
<script src="./js/profanity.js?v=6"></script>
<script src="./js/profiles.js?v=6"></script>
<script src="./js/generator.js?v=6"></script>
<script src="./js/icons.js?v=6"></script>
<script>
// Warten auf Storage + Profiles Init
STORAGE.onReady(async () => {
    await PROFILES.init();
    
    // Profil prüfen
    const profile = PROFILES.getCurrent();
    if (!profile) {
        window.location.href = './index.html';
        return;
    }

    // Stats laden
    const stats = PROFILES.getStats();

// Willkommen
document.getElementById('welcomeTitle').textContent = `Hallo, ${stats.name}!`;

// Statistiken anzeigen
document.getElementById('statSolved').textContent = stats.solved;
document.getElementById('statAccuracy').textContent = stats.accuracy + '%';
document.getElementById('statBest').textContent = stats.bestStreak;
document.getElementById('streakCount').textContent = stats.currentStreak;

// Progress Bar
const progress = Math.round((stats.solved / 11) * 100);
document.getElementById('progressFill').style.width = progress + '%';
document.getElementById('progressText').textContent = stats.solved + ' von 11 Aufgaben gemeistert';

// Task Grid
const taskGrid = document.getElementById('taskGrid');
const taskIds = GENERATOR.getAllTaskIds();

taskIds.forEach(id => {
    const btn = document.createElement('a');
    btn.href = './trainer.html?task=' + id;
    btn.className = 'task-btn';
    
    if (stats.solvedTasks.includes(id)) {
        btn.classList.add('solved');
    }
    
    btn.innerHTML = '<span>' + id + '</span>';
    taskGrid.appendChild(btn);
});

// Random Button
const randomBtn = document.createElement('a');
randomBtn.href = './trainer.html?random=1';
randomBtn.className = 'task-btn random';
randomBtn.innerHTML = '<span><svg class="icon icon-sm" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="7" x2="7.01" y2="7"></line><line x1="17" y1="7" x2="17.01" y2="7"></line><line x1="7" y1="17" x2="7.01" y2="17"></line><line x1="17" y1="17" x2="17.01" y2="17"></line><line x1="12" y1="12" x2="12.01" y2="12"></line></svg></span>';
taskGrid.appendChild(randomBtn);

}); // Ende STORAGE.onReady
</script>

</body>
</html>
