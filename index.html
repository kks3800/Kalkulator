<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kalkulations-Trainer | H√∂rakustik</title>
    <meta name="description" content="√úbungsapp f√ºr Preiskalkulation H√∂rakustik - Lernfeld 17.2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Header -->
<header class="header">
    <h1><span class="header-icon">üìä</span> Kalkulations-Trainer</h1>
    <p>Lernfeld 17.2 ¬∑ H√∂rakustik</p>
</header>

<div class="container">

    <!-- Hero Section -->
    <div class="hero">
        <div class="hero-icon">üéØ</div>
        <h2>Pr√ºfungsvorbereitung</h2>
        <p>√úbe alle 11 Kalkulationsaufgaben mit Schritt-f√ºr-Schritt Erkl√§rungen</p>
    </div>

    <!-- Stats Card -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Dein Fortschritt</span>
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="statSolved">0</div>
                <div class="stat-label">Gel√∂st</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statStreak">0</div>
                <div class="stat-label">Beste Serie</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="statSessions">0</div>
                <div class="stat-label">Sessions</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <p class="text-center text-muted mt-1" id="progressText">0 von 11 Aufgaben gemeistert</p>
    </div>

    <!-- Last Session Info -->
    <div class="card" id="lastSessionCard" style="display: none;">
        <div class="card-header">
            <span class="card-title">Letzte √úbung</span>
        </div>
        <p class="text-muted" id="lastSessionText">‚Äî</p>
    </div>

    <!-- Main CTA -->
    <a href="trainer.html" class="btn btn-primary btn-block btn-lg" style="text-decoration: none;">
        üöÄ √úbung starten
    </a>

    <!-- Quick Actions -->
    <div class="actions mt-2">
        <a href="trainer.html?random=1" class="btn btn-secondary" style="text-decoration: none;">
            üé≤ Zuf√§llige Aufgabe
        </a>
        <button type="button" class="btn btn-secondary" onclick="showFormulas()">
            üìê Formeln
        </button>
    </div>

    <!-- Reference Card -->
    <details class="ref-card">
        <summary>üìã Betriebsdaten (Zuschlagss√§tze)</summary>
        <div class="ref-content">
            <div class="ref-row">
                <span>MGK H√∂rger√§te</span>
                <span class="val">32,8 %</span>
            </div>
            <div class="ref-row">
                <span>MGK Otoplastik/Material</span>
                <span class="val">35,4 %</span>
            </div>
            <div class="ref-row">
                <span>MGK Handelswaren</span>
                <span class="val">108 %</span>
            </div>
            <div class="ref-row">
                <span>Fert. HG-Anpassung</span>
                <span class="val">60,50 ‚Ç¨/Std</span>
            </div>
            <div class="ref-row">
                <span>Fert. Audiometrie</span>
                <span class="val">63,40 ‚Ç¨/Std</span>
            </div>
            <div class="ref-row">
                <span>Fert. Werkstatt/Labor</span>
                <span class="val">58,90 ‚Ç¨/Std</span>
            </div>
        </div>
    </details>

    <!-- Reset Stats -->
    <div class="text-center mt-2">
        <button type="button" class="btn btn-secondary" onclick="confirmReset()" style="font-size: 0.85rem; padding: 10px 16px;">
            üóëÔ∏è Fortschritt zur√ºcksetzen
        </button>
    </div>

</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <div class="modal-header">
            <h3 id="modalTitle">Info</h3>
            <button type="button" class="modal-close" id="modalClose">√ó</button>
        </div>
        <div class="modal-body" id="modalBody">
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="modalOk">Verstanden</button>
        </div>
    </div>
</div>

<script src="app.js"></script>
<script>
// Statistiken laden und anzeigen
function updateDisplay() {
    var stats = loadStats();
    
    document.getElementById('statSolved').textContent = stats.solvedTasks.length;
    document.getElementById('statStreak').textContent = stats.bestStreak;
    document.getElementById('statSessions').textContent = stats.sessions.length;
    
    var progress = Math.round((stats.solvedTasks.length / 11) * 100);
    document.getElementById('progressFill').style.width = progress + '%';
    document.getElementById('progressText').textContent = stats.solvedTasks.length + ' von 11 Aufgaben gemeistert';
    
    // Letzte Session anzeigen
    if (stats.lastSession) {
        var lastDate = new Date(stats.lastSession);
        var now = new Date();
        var diff = now - lastDate;
        var diffHours = Math.floor(diff / (1000 * 60 * 60));
        var diffDays = Math.floor(diff / (1000 * 60 * 60 * 24));
        
        var timeText;
        if (diffHours < 1) {
            timeText = 'Gerade eben';
        } else if (diffHours < 24) {
            timeText = 'Vor ' + diffHours + ' Stunde' + (diffHours > 1 ? 'n' : '');
        } else {
            timeText = 'Vor ' + diffDays + ' Tag' + (diffDays > 1 ? 'en' : '');
        }
        
        document.getElementById('lastSessionCard').style.display = 'block';
        document.getElementById('lastSessionText').textContent = timeText;
    }
}

// Formeln anzeigen
function showFormulas() {
    var content = '<div class="formula-card" style="margin:0;">';
    content += '<div class="formula-list">';
    content += 'MEK = Listenpreis + Bezugskosten<br>';
    content += 'MGK = MEK √ó Zuschlagssatz<br>';
    content += 'Mges = MEK + MGK<br>';
    content += 'Fert = (Min √∑ 60) √ó ‚Ç¨/Std<br>';
    content += 'Sk = Mges + Fertigung<br>';
    content += 'Gewinn = Sk √ó %<br>';
    content += 'NVP = Sk + Gewinn<br>';
    content += 'BVP = NVP √ó 1,19';
    content += '</div></div>';
    
    showModal('üìê Formeln', content);
}

// Fortschritt zur√ºcksetzen
function confirmReset() {
    if (confirm('Wirklich alle Statistiken l√∂schen? Das kann nicht r√ºckg√§ngig gemacht werden.')) {
        resetStats();
        updateDisplay();
        alert('Fortschritt wurde zur√ºckgesetzt!');
    }
}

// Modal Event Listeners
document.getElementById('modalOverlay').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});
document.getElementById('modalClose').addEventListener('click', closeModal);
document.getElementById('modalOk').addEventListener('click', closeModal);

// Start
updateDisplay();
</script>

</body>
</html>

